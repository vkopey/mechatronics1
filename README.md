# mechatronics1
Simple mechatronic system based on Arduino, Python, OpenCV and scikit-image

Проста мехатронна система на основі Arduino, Python, OpenCV і scikit-image

Метою роботи є розроблення простого, гнучкого і недорогого лабораторного стенда для вивчення мехатронних технологічних систем з машинним зором. Стенд повинен використовувати доступні усім компоненти. Тому було обрано такі компоненти: плата Arduino UNO, сервопривід SG90, персональний комп'ютер, веб-камера та вільне програмне забезпечення (Python, pyFirmata, StandardFirmata, OpenCV, scikit-image).

На рис. показано схему лабораторного стенда. Кулька 1 може перекочуватись вздовж кривошипа з жолобом 2. Цей кривошип з'єднаний з кривошипом (коромислом) сервоприводу 3 за допомогою гнучкої ланки. Сервопривід (SG90 9g Micro Servo) може повертати кривошип вправо або вліво на заданий кут. Ціллю мехатронної системи є виставлення кульки в задане положення. Сервопривід приєднаний до Arduino UNO трьома провідниками: жовтим (Y-9), червоним (R-5V), коричневим (B-GND). Arduino UNO з'єднана з комп'ютером (PC) за допомогою USB. Фактично для передачі даних між Python програмою, що виконується на комп'ютері, і Arduino використовується віртуальний COM-порт і протокол Firmata. Для цього в мікроконтролер Arduino завантажена програма StandardFirmata, а Python використовує пакет pyFirmata. Для визначення положення кульки використовується USB-веб-камера та програмне забезпечення для комп'ютерного зору OpenCV і scikit-image. В даному випадку OpenCV використовується тільки для отримання зображення з камери, а scikit-image реалізує алгоритми машинного зору для визначення положення кульки. Проте, з метою підвищення швидкодії системи, користувач може використовувати тільки процедури OpenCV.
В розробленій програмі створюється об'єкт для комунікації з Arduino, об'єкт servo для управління сервоприводом та об'єкт cap для отримання відеокадрів з камери. Основний алгоритм являє собою цикл, в якому отримується відеокадр, зображення конвертується у відтінки сірого, передається у функцію користувача detObj, яка призначена для визначення координат кульки за допомогою процедур scikit-image. Ці координати використовуються об'єктом servo для управління сервоприводом.

![Рис.][mechatronics1.png]

1 - кулька, 2 - кривошип з жолобом, 3 - кривошип  сервоприводу

Рис. - Схема лабораторного стенда

```python
while(True):
    ret, frame = cap.read()
    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
    cx, cy, r = detObj(gray)
    servo.write(cx/20)
```

У detObj для визначення границь об'єктів використовується алгоритм Кенні. Ці границі і список значень радіусів кілець R, які потрібно виявити, передаються функціям для визначення кільцевих форм на основі перетворення Хафа. Функції знаходять найбільш імовірні координати центра кільця (cx, cy):

```python
edges = canny(image, sigma=2, low_threshold=10, high_threshold=20)
R = [16]; hough_res = hough_circle(edges, R)
accums, cx, cy, r = hough_circle_peaks(hough_res, R,
                                       total_num_peaks=1)
```

Розроблений стенд та програма можуть бути основою для проектування більш складних систем для автоматизації машинобудівного виробництва з простим приєднанням інших компонентів, таких як датчики, актуатори чи Python-пакети.

Якщо Ви використовуєте ці матеріали у своїх працях, то будь ласка вказуйте посилання на цю сторінку або на працю:

> Копей В.Б., Бурак О.В. Лабораторний стенд на основі Arduino, Python, OpenCV та scikit-image для вивчення мехатронних систем / Машинобудування очима молодих: прогресивні ідеї – наука – виробництво: матеріали Дев'ятнадцятої міжнародної молодіжної науково-технічної конференції (м. Суми, 25–26 листопаду 2020 року) / редкол.: В. О. Залога, О. В. Івченко. Суми : Сумський державний університет, 2020. С.155-158.
